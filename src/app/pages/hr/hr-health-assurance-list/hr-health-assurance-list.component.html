<div class="search-container">
 <input type="text" [(ngModel)]="searchTerm" placeholder="ุงุจุญุซ ุนู ุงููุณุชุฎุฏู" class="search-input" dir="rtl" />
</div>

<div *ngIf="isLoading" class="spinner">Loading...</div>
<div *ngIf="errorMessage" class="error-message">{{ errorMessage }}</div>

<div *ngIf="!isLoading && !errorMessage">
 <div class="table-container">
  <h2>ูุงุฆูุฉ ุทูุจุงุช ุงูุชุฃููู ุงูุตุญู</h2>
  <table class="health-assurance-table" dir="rtl">
   <thead>
    <tr>
     <th>ุงุณู ุงูููุธู</th>
     <th>ุงูุฅุฏุงุฑุฉ</th>
     <th>ุงูุญุงูุฉ</th>
    </tr>
   </thead>
   <tbody>
    <tr *ngFor="let assurance of filteredHealthAssurances" (click)="openModal(assurance)" class="clickable-row">
     <td>{{ assurance.name }}</td>
     <td>{{ assurance.administration }}</td>
     <td>
      <span *ngIf="assurance.state === 'Approved'" class="status accepted">โ๏ธ ููุจููุฉ</span>
      <span *ngIf="assurance.state === 'Rejected'" class="status rejected">โ ูุฑููุถุฉ</span>
      <span *ngIf="assurance.state === 'Pending'" class="status pending">๐ ููุฏ ุงูุชูููุฐ</span>
     </td>
    </tr>
    <tr *ngIf="filteredHealthAssurances.length === 0">
     <td colspan="3" class="empty-message">ูุง ุชูุฌุฏ ุจูุงูุงุช ูุนุฑุถูุง.</td>
    </tr>
   </tbody>
  </table>
 </div>
</div>

<!-- Modal for Health Assurance Details -->
<div *ngIf="isModalVisible" class="modal">
 <div class="modal-content">
  <!-- Close button (X) -->
  <button class="close-btn" (click)="closeModal()">ร</button>

  <h3>ุชูุงุตูู ุงูุทูุจ</h3>
  <p><strong>ุงุณู ุงูููุธู:</strong> {{ selectedAssurance?.name }}</p>
  <p><strong>ุงุณู ุงูุฃุจ:</strong> {{ selectedAssurance?.father_name }}</p>
  <p><strong>ุงุณู ุงูุฌุฏ:</strong> {{ selectedAssurance?.grandfather_name }}</p>
  <p><strong>ุงุณู ุงูุฃู:</strong> {{ selectedAssurance?.mother_name }}</p>
  <p><strong>ุงุณู ุงูุนุงุฆูุฉ:</strong> {{ selectedAssurance?.family_last_name }}</p>
  <p><strong>ุงูุฅุฏุงุฑุฉ:</strong> {{ selectedAssurance?.administration }}</p>
  <p><strong>ุงูุญุงูุฉ ุงูุญุงููุฉ:</strong>
   <span *ngIf="selectedAssurance?.state === 'Approved'" class="status accepted">โ๏ธ ููุจููุฉ</span>
   <span *ngIf="selectedAssurance?.state === 'Rejected'" class="status rejected">โ ูุฑููุถุฉ</span>
   <span *ngIf="selectedAssurance?.state === 'Pending'" class="status pending">๐ ููุฏ ุงูุชูููุฐ</span>
  </p>

  <!-- Document Links -->
  <div *ngIf="selectedAssurance?.birth_certificate || selectedAssurance?.family_state_certificate"
   class="document-links">
   <h4>ุงููุซุงุฆู:</h4>
   <button *ngIf="selectedAssurance?.birth_certificate" (click)="openDocument(selectedAssurance.birth_certificate)">
    ุนุฑุถ ุดูุงุฏุฉ ุงููููุงุฏ
   </button>
   <button *ngIf="selectedAssurance?.family_state_certificate"
    (click)="openDocument(selectedAssurance.family_state_certificate)">
    ุนุฑุถ ุดูุงุฏุฉ ุงููุถุน ุงูุนุงุฆูู
   </button>
  </div>

  <!-- Show buttons only if the state is 'Pending' -->
  <div class="button-group" *ngIf="selectedAssurance?.state === 'Pending'">
   <button class="approve-btn" (click)="updateAssuranceState('Approved')">ููุงููุฉ</button>
   <button class="reject-btn" (click)="updateAssuranceState('Rejected')">ุฑูุถ</button>
  </div>
  </div>
  </div>